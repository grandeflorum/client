<div style="height: 100%;">
  <div class="card-container">
    <nz-tabset [nzTabPosition]="'top'" [nzType]="'card'" [nzSelectedIndex]="tabsetIndex"
      (nzSelectedIndexChange)="tabsetChange($event)">
      <nz-tab *ngFor="let tab of tabs" [nzTitle]="tab.name"></nz-tab>
    </nz-tabset>
  </div>

  <!-- 基本信息 -->
  <div class="jbxx" *ngIf="tabsetIndex==0">
    <nz-divider nzText="基本信息" nzOrientation="left" style="font-size: 18px"></nz-divider>
    <div nz-row style="height: 50px;padding: 10px;">
      <div nz-col [nzSpan]="8">
        <div class="label_div"><span class="clo_r">*</span>开发项目名称：</div>
        <span> <input nz-input nzSize="default" [(ngModel)]="detailObj.xmmc" title={{detailObj.xmmc}}
            [disabled]="isDisable" required [validation]="true" maxlength="100" class="w200"
            placeholder="请输入项目名称" /></span>

      </div>
      <div nz-col [nzSpan]="8">
        <div class="label_div"><span class="clo_r">*</span>期数：</div>
        <span>
          <nz-select [(ngModel)]="detailObj.qs" class="w200" [disabled]="isDisable" nzAllowClear nzPlaceHolder="请选择"
            required [validation]="true">
            <nz-option *ngFor="let option of dictionaryObj.qs" [nzLabel]="option.name" [nzValue]="option.code">
            </nz-option>
          </nz-select>
        </span>

      </div>
      <div nz-col [nzSpan]="8">
        <div class="label_div"><span class="clo_r">*</span>批次：</div>
        <span>
          <nz-select [(ngModel)]="detailObj.pc" class="w200" [disabled]="isDisable" nzAllowClear nzPlaceHolder="请选择"
            required [validation]="true">
            <nz-option *ngFor="let option of dictionaryObj.pc" [nzLabel]="option.name" [nzValue]="option.code">
            </nz-option>
          </nz-select>
        </span>

      </div>
    </div>

    <div nz-row style="height: 50px;padding: 10px;">
      <div nz-col [nzSpan]="8">
        <div class="label_div"><span class="clo_r">*</span>开发企业名称：</div>
        <span>
          <!-- <input nz-input nzSize="default" [(ngModel)]="detailObj.kfqymc" class="w200" maxlength="100"
            placeholder="请输入开发企业名称" [disabled]="isDisable" required [validation]="true" /> -->

          <nz-select class="w200" (ngModelChange)="selectChange($event)" [disabled]="isDisable" nzPlaceHolder="选择开发企业"
            nzShowSearch nzServerSearch [(ngModel)]="detailObj.companyId" (nzOnSearch)="onSearch($event)">
            <ng-container *ngFor="let o of companyList">
              <nz-option *ngIf="!companyLoading" [nzValue]="o.id" [nzLabel]="o.qymc"></nz-option>
            </ng-container>
            <nz-option *ngIf="companyLoading" nzDisabled nzCustomContent>
              <i nz-icon nzType="loading" class="loading-icon"></i> Loading Data...
            </nz-option>
          </nz-select>
        </span>

      </div>
      <div nz-col [nzSpan]="8">
        <div class="label_div"><span class="clo_r">*</span>项目负责人：</div>
        <span>
          <input nz-input nzSize="default" [(ngModel)]="detailObj.xmfzr" title={{detailObj.xmfzr}} class="w200"
            placeholder="请输入项目负责人" [disabled]="isDisable" required [validation]="true" maxlength="15" />
        </span>

      </div>
      <div nz-col [nzSpan]="8">
        <div class="label_div"><span class="clo_r">*</span>项目用途：</div>
        <span>
          <nz-select [(ngModel)]="detailObj.xmyt" class="w200" [disabled]="isDisable" nzAllowClear nzPlaceHolder="请选择"
            required [validation]="true">
            <nz-option *ngFor="let option of dictionaryObj.fwyt" [nzLabel]="option.name" [nzValue]="option.code">
            </nz-option>
          </nz-select>
        </span>

      </div>
    </div>

    <div nz-row style="height: 50px;padding: 10px;">
      <div nz-col [nzSpan]="8">
        <div class="label_div"><span class="clo_r">*</span>联系电话：</div>
        <span>
          <input nz-input nzSize="default" [(ngModel)]="detailObj.phone" title={{detailObj.phone}}
            [disabled]="isDisable" maxlength="15" required [validation]="true" [validationType]="'phonenumber'"
            class="w200" placeholder="请输入联系电话" />
        </span>

      </div>
      <div nz-col [nzSpan]="8">
        <div class="label_div"><span class="clo_r">*</span>占地面积：</div>
        <span>
          <input nz-input nzSize="default" [(ngModel)]="detailObj.zdmj" title={{detailObj.zdmj}} [disabled]="isDisable"
            maxlength="10" required [validation]="true" [validationType]="'areaNumber'" class="w200"
            placeholder="请输入占地面积" />
        </span>
        &nbsp;㎡
      </div>
      <div nz-col [nzSpan]="8">
        <div class="label_div">土地投资：</div>
        <span>
          <input nz-input nzSize="default" [(ngModel)]="detailObj.tdtz" title={{detailObj.tdtz}} maxlength="10"
            [disabled]="isDisable" [validation]="true" [validationType]="'nullMoney'" class="w200"
            placeholder="请输入土地投资" />
        </span>
        &nbsp;万元

      </div>
    </div>

    <div nz-row style="height: 50px;padding: 10px;">
      <div nz-col [nzSpan]="8">
        <div class="label_div">计划总投资：</div>
        <span>
          <input nz-input nzSize="default" [(ngModel)]="detailObj.ztz" title={{detailObj.ztz}} [disabled]="isDisable"
            maxlength="10" [validation]="true" [validationType]="'nullMoney'" class="w200" placeholder="请输入计划总投资" />
        </span>
        &nbsp;万元
      </div>
      <div nz-col [nzSpan]="8">
        <div class="label_div">总投资中自有资金：</div>
        <span>
          <input nz-input nzSize="default" [(ngModel)]="detailObj.ztzzyzj" title={{detailObj.ztzzyzj}}
            [disabled]="isDisable" maxlength="10" [validation]="true" [validationType]="'nullMoney'" class="w200"
            placeholder="请输入总投资中自有资金" />
        </span>
        &nbsp;万元
      </div>
      <div nz-col [nzSpan]="8">
        <div class="label_div">总投资中融资金额：</div>
        <span> <input nz-input nzSize="default" [(ngModel)]="detailObj.ztzrzzj" title={{detailObj.ztzrzzj}}
            [disabled]="isDisable" maxlength="10" [validation]="true" [validationType]="'nullMoney'" class="w200"
            placeholder="请输入总投资中融资金额" /></span>
        &nbsp;万元
      </div>
    </div>

    <div nz-row style="height: 50px;padding: 10px;">
      <div nz-col [nzSpan]="8">
        <div class="label_div"><span class="clo_r">*</span>当前工程进度：</div>
        <span><input nz-input nzSize="default" [(ngModel)]="detailObj.gcjd" title={{detailObj.gcjd}}
            [disabled]="isDisable" maxlength="50" required [validation]="true" class="w200"
            placeholder="请输入当前工程进度" /></span>

      </div>
      <div nz-col [nzSpan]="8">
        <div class="label_div"><span class="clo_r">*</span>项目状态：</div>
        <span>
          <nz-select [(ngModel)]="detailObj.xmzt" class="w200" [disabled]="isDisable" nzAllowClear nzPlaceHolder="请选择"
            required [validation]="true">
            <nz-option *ngFor="let option of dictionaryObj.xmzt" [nzLabel]="option.name" [nzValue]="option.code">
            </nz-option>
          </nz-select>
        </span>

      </div>
      <div nz-col [nzSpan]="8">
        <div class="label_div">拆迁标志：</div>
        <span>
          <nz-select [(ngModel)]="detailObj.cqbz" class="w200" [disabled]="isDisable" nzAllowClear nzPlaceHolder="请选择">
            <nz-option *ngFor="let option of dictionaryObj.cqbz" [nzLabel]="option.name" [nzValue]="option.code">
            </nz-option>
          </nz-select>
        </span>

      </div>
    </div>

    <div nz-row style="height: 50px;padding: 10px;">
      <div nz-col [nzSpan]="8">
        <div class="label_div"><span class="clo_r">*</span>开工日期：</div>
        <span>
          <nz-date-picker class="w200" [nzStyle]="{'width':'150px'}" [nzAllowClear]="false" [disabled]="isDisable"
            [(ngModel)]="detailObj.kgrq" (ngModelChange)="onChange(1,$event)" required [validation]="true">
          </nz-date-picker>
        </span>

      </div>
      <div nz-col [nzSpan]="8">
        <div class="label_div"><span class="clo_r">*</span>竣工日期：</div>
        <span>
          <nz-date-picker class="w200" [nzStyle]="{'width':'150px'}" [nzAllowClear]="false" [disabled]="isDisable"
            [(ngModel)]="detailObj.jgrq" (ngModelChange)="onChange(2,$event)" required [validation]="true">
          </nz-date-picker>
        </span>

      </div>


    </div>

    <div nz-row style="height: 50px;padding: 10px;">
      <div nz-col [nzSpan]="24">
        <div class="label_div">建设工程规划许可证号：</div>
        <input style="width: calc(100% - 240px);" nz-input nzSize="default" [(ngModel)]="detailObj.jsgcghxkzh"
          title={{detailObj.jsgcghxkzh}} [disabled]="isDisable" maxlength="255" placeholder="请输入建设工程规划许可证号" />

      </div>



    </div>

    <div nz-row style="height: 50px;padding: 10px;">
      <div nz-col [nzSpan]="24">
        <div class="label_div">建筑工程施工许可证号：</div>
        <input style="width: calc(100% - 240px);" nz-input nzSize="default" [(ngModel)]="detailObj.jsgcsgxkzh"
          title={{detailObj.jsgcsgxkzh}} [disabled]="isDisable" maxlength="255" placeholder="请输入建筑工程施工许可证号" />

      </div>
    </div>

    <div nz-row style="height: 50px;padding: 10px;">

      <div nz-col [nzSpan]="24">
        <div class="label_div">详细地址：</div>
        <input style="width: calc(100% - 240px);" nz-input nzSize="default" [(ngModel)]="detailObj.address"
          title={{detailObj.address}} [disabled]="isDisable" maxlength="255" placeholder="请输入详细地址" />

      </div>
    </div>

    <nz-divider nzText="土地信息" nzOrientation="left" style="font-size: 18px"></nz-divider>

    <div nz-row style="height: 50px;padding: 10px;">
      <div nz-col [nzSpan]="8">
        <div class="label_div"><span class="clo_r">*</span>用地取得方式：</div>
        <span>
          <nz-select [(ngModel)]="detailObj.ydqdfs" class="w200" [disabled]="isDisable" nzAllowClear nzPlaceHolder="请选择"
            required [validation]="true">
            <nz-option *ngFor="let option of dictionaryObj.ydqdfs" [nzLabel]="option.name" [nzValue]="option.code">
            </nz-option>
          </nz-select>
        </span>

      </div>
      <div nz-col [nzSpan]="8">
        <div class="label_div"><span class="clo_r">*</span>地段类别：</div>
        <span>
          <nz-select [(ngModel)]="detailObj.ddlb" class="w200" [disabled]="isDisable" nzAllowClear nzPlaceHolder="请选择"
            required [validation]="true">
            <nz-option *ngFor="let option of dictionaryObj.ddlb" [nzLabel]="option.name" [nzValue]="option.code">
            </nz-option>
          </nz-select>
        </span>

      </div>
      <div nz-col [nzSpan]="8">
        <div class="label_div"><span class="clo_r">*</span>不动产权证号：</div>
        <span> <input nz-input nzSize="default" [(ngModel)]="detailObj.tdsyzh" title={{detailObj.tdsyzh}} maxlength="50"
            [disabled]="isDisable" required [validation]="true" class="w200" placeholder="请输入土地使用证号" /></span>

      </div>
    </div>

    <div nz-row style="height: 50px;padding: 10px;">
      <div nz-col [nzSpan]="8">
        <div class="label_div" style="width:150px"><span class="clo_r">*</span>土地使用证批准时间：</div>
        <span>
          <nz-date-picker [nzStyle]="{'width':'150px'}" [nzAllowClear]="false" [(ngModel)]="detailObj.pzsj" required
            [validation]="true">
          </nz-date-picker>
        </span>

      </div>


      <div nz-col [nzSpan]="8">
        <div class="label_div">土地使用权终止日期：</div>
        <span>
          <nz-date-picker [nzStyle]="{'width':'150px'}" [nzAllowClear]="false" [disabled]="isDisable"
            [(ngModel)]="detailObj.tdsyzzzrq" (ngModelChange)="onChange(3,$event)" required [validation]="true">
          </nz-date-picker>
        </span>

      </div>
    </div>

    <nz-divider nzText="房屋信息" nzOrientation="left" style="font-size: 18px"></nz-divider>

    <div nz-row style="height: 50px;padding: 10px;">
      <div nz-col [nzSpan]="8">
        <div class="label_div"><span class="clo_r">*</span>总建筑面积：</div>
        <span><input nz-input nzSize="default" [(ngModel)]="detailObj.zjzmj" title={{detailObj.zjzmj}}
            [disabled]="isDisable" maxlength="10" required [validation]="true" [validationType]="'areaNumber'"
            class="w200" placeholder="请输入总建筑面积" /></span>
        &nbsp;㎡
      </div>
      <div nz-col [nzSpan]="8">
        <div class="label_div"><span class="clo_r">*</span>住宅面积：</div>
        <span> <input nz-input nzSize="default" [(ngModel)]="detailObj.zzmj" title={{detailObj.zzmj}}
            [disabled]="isDisable" maxlength="10" required [validation]="true" [validationType]="'areaNumber'"
            class="w200" placeholder="请输入住宅面积" /></span>
        &nbsp;㎡

      </div>
      <div nz-col [nzSpan]="8">
        <div class="label_div"><span class="clo_r">*</span>套数：</div>
        <span> <input nz-input nzSize="default" [(ngModel)]="detailObj.zzts" title={{detailObj.zzts}}
            [disabled]="isDisable" maxlength="4" required [validation]="true" [validationType]="'nullnumber'"
            class="w200" placeholder="请输入套数" /></span>
        &nbsp;套

      </div>
    </div>

    <div nz-row style="height: 50px;padding: 10px;">
      <div nz-col [nzSpan]="8"></div>
      <div nz-col [nzSpan]="8">
        <div class="label_div"><span class="clo_r">*</span>非住宅面积：</div>
        <span><input nz-input nzSize="default" [(ngModel)]="detailObj.fzzmj" title={{detailObj.fzzmj}}
            [disabled]="isDisable" maxlength="10" required [validation]="true" [validationType]="'areaNumber'"
            class="w200" placeholder="请输入非住宅面积" /></span>
        &nbsp;㎡
      </div>
      <div nz-col [nzSpan]="8">
        <div class="label_div"><span class="clo_r">*</span>套数：</div>
        <span> <input nz-input nzSize="default" [(ngModel)]="detailObj.fzzts" title={{detailObj.fzzts}}
            [disabled]="isDisable" maxlength="4" required [validation]="true" [validationType]="'nullnumber'"
            class="w200" placeholder="请输入套数" /></span>
        &nbsp;套
      </div>
    </div>

    <nz-divider nzText="重点提示" nzOrientation="left" style="font-size: 18px"></nz-divider>

    <textarea nz-input [nzAutosize]="{ minRows: 5, maxRows: 8 }" [disabled]="isDisable" [(ngModel)]="detailObj.zyts"
      maxlength="250" placeholder="请输入重点提示"></textarea>

    <nz-divider nzText="备注" nzOrientation="left" style="font-size: 18px"></nz-divider>

    <textarea nz-input [nzAutosize]="{ minRows: 5, maxRows: 8 }" [disabled]="isDisable" [(ngModel)]="detailObj.bz"
      maxlength="250" placeholder="请输入备注"></textarea>
  </div>

  <!-- 附件 -->
  <div class="jbxx" *ngIf="tabsetIndex==1" style="overflow: hidden">
    <div nz-row style="height: 50px;padding: 10px;">
      <button *ngIf="!isDisable" nz-button nzType="primary" [nzVisible]="!detailObj.id" [disabled]="!detailObj.id"
        nz-tooltip nzTooltipTitle="请先保存项目信息" nzTooltipPlacement="bottom" (click)="upload()"><i nz-icon
          nzType="plus"></i>
        上传附件
      </button>
      <button nz-button nzType="default" *ngIf="!isDisable" nz-popconfirm nzTitle="确定删除吗?"
        (nzOnConfirm)="btachDelete()">
        批量删除
      </button>
      <button nz-button nzType="default" *ngIf="!isDisable" (click)="btachDown()">
        批量下载
      </button>
    </div>

    <nz-table #nestedTable [nzData]="fjList" class="commontable tablescoll_rainbow" [nzLoading]="Loading"
    [nzShowTotal]="rangeTemplate" [nzPageIndex]="pageIndex" [nzPageSize]="pageSize" [nzTotal]="totalCount"
      (nzPageIndexChange)="pageIndexChange($event)" (nzPageSizeChange)="pageSizeChange($event)" nzShowPagination nzShowQuickJumper nzShowSizeChanger
      (nzCurrentPageDataChange)="currentPageDataChange($event)" [nzScroll]="tableIsScroll">
      <thead>
        <tr>
          <th style="width:10%" nzShowCheckbox [(nzChecked)]="isAllDisplayDataChecked"
            [nzIndeterminate]="isIndeterminate" (nzCheckedChange)="checkAll($event)"></th>
          <th>附件名称</th>
          <th>上传日期</th>
          <th>操作</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let data of nestedTable.data; index as index" [ngClass]="{ itemSeleted: data.id == selectId }"
          (click)="selectItem(data)">
          <td style="width:10%" nzShowCheckbox [(nzChecked)]="mapOfCheckedId[data.id]" [nzDisabled]="data.disabled"
            (nzCheckedChange)="refreshStatus()"></td>
          <td>{{ data.clientFileName }}</td>
          <td>{{ data.uploadDate | date:'yyyy-MM-dd HH:mm:ss' }}</td>
          <td style="width:30%">
            <a class="table_a"
              *ngIf="data.fileSuffix=='jpg' || data.fileSuffix=='jpeg' || data.fileSuffix=='png' || data.fileSuffix=='bmp' ||  data.fileSuffix=='pdf'"
              (click)="previewImg(data)">查看</a>
            <a class="table_a" *ngIf="!isDisable" nz-popconfirm nzTitle="确定删除吗?"
              (nzOnConfirm)="btachDelete(data)">删除</a>
            <a class="table_a" (click)="btachDown(data)">下载</a>
          </td>
        </tr>
      </tbody>
    </nz-table>
  </div>

  <!-- <div class="jbxx" *ngIf="tabsetIndex==2&&detailObj.id" style="overflow: hidden">
    <app-associated-company [associatedid]="detailObj.id" modulename="kfxmgl" [selectShow]="!isDisable">
    </app-associated-company>
  </div> -->





  <div nz-row style="height: 50px;padding: 10px;text-align: right;padding-right: 20px;">
    <div nz-col [nzSpan]="24">
      <button nz-button nzType="default" (click)="cancel()">返回</button>
      <button nz-button nzType="primary" *ngIf="!isDisable&&tabsetIndex==0" [disabled]="isbusy"
        (click)="save()">保存</button>
      <!-- <button nz-button nzType="primary" *ngIf="!isDisable" (click)="submit()">提交审核</button> -->
    </div>

  </div>


</div>

<nz-modal [(nzVisible)]="isVisible" nzTitle="附件上传" (nzOnCancel)="handleCancel()" (nzOnOk)="handleOk()" [nzOkLoading]="isOkLoading">
  <app-upload #uploadComponent [refid]="detailObj.id" (outer)="outer($event)"></app-upload>
</nz-modal>

<nz-modal [(nzVisible)]="isImgVisible" nzTitle="附件预览" (nzOnCancel)="isImgVisible = false" [nzFooter]="null">
  <img src="{{currentImg}}" style="width:100%" id="image">
</nz-modal>

<ng-template #rangeTemplate let-range="range" let-total>
  共{{total}}条记录&nbsp;&nbsp;
</ng-template>